"use strict";
define(['application-configuration','lodash','customerSettingsFactory'], function (app) {
    app.register.controller('regionMappingController', ['$scope','$rootScope','customerSettingsFactory','Notify',
        '$modal',
        function ($scope,$rootScope,customerSettingsFactory,Notify,$modal) {
            initializeData();
            function initializeData(){
                $scope.regionMappingCollection=[];
                var selectedCustomer = customerSettingsFactory.GetSelectedCustomer().Others;
                $scope.customer={
                    SessionId:$scope.currentuser.SessionId,
                    CustomerId: selectedCustomer.CustomerId
                };
                customerSettingsFactory.GetRegionMapping($scope.customer);
            }

            $scope.$on(Notify.CUSTOMER_SETTINGS_REGION_MAPPING_DATA_READY, function (event) {
                $scope.rowCollection=customerSettingsFactory.RegionMappingList();
                _.forEach($scope.rowCollection,function(item){
                    item.isEditDeleteHide=true;

                });
                $scope.regionMappingCollection=[].concat($scope.rowCollection);
            });
            $scope.$watch( function($scope){ return $scope.selectedCustomer}, function(newValue,oldValue){
                if(angular.isUndefined(newValue)|| (newValue.CustomerId === oldValue.CustomerId))
                    return;
                else{
                    initializeData();
                }
            });
        }]);
});

